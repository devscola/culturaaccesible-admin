<link rel="import" href="/vendor/polymer/polymer.html">
<link rel="import" href="/web-components/museum/form/cuac-schedule-days.html">
<link rel="import" href="/web-components/museum/form/cuac-schedule-hours.html">

<dom-module id="cuac-schedule-form">
    <template>
        <cuac-schedule-days class="col-md-12" checked="{{marked}}" selection="{{selectedDays}}"></cuac-schedule-days>
        <cuac-schedule-hours class="col-md-12" days="{{selectedDays}}" selection="{{selectedHours}}"></cuac-schedule-hours>
        <div class="panel col-md-12">
            <template is="dom-repeat" items="{{renderedSchedule}}">
                <div>
                    <label>{{item.day}}</label>
                    <template is="dom-repeat" items="{{item.hours}}" as="hours">
                        <span> {{hours}} </span>
                    </template>
                </div>
            </template>
        </div>
    </template>
    <script>
        Polymer({
            is: 'cuac-schedule-form',

            properties: {

                selectedDays: {type: Array, value: []},

                marked: {type: Boolean, value: false},

                selectedHours: {type: String, observer: 'arrangeSchedule'},

                scheduleData: {type: Object},

                renderedSchedule: {type: Array}

            },

            arrangeSchedule: function() {
                this.storeSchedule();
                this.resetDays();
                this.generateRenderedSchedule();
                this.selectedHours = '';
            },

            storeSchedule: function() {
                this.selectedDays.forEach(function(day) {
                    this.scheduleData[day].push(this.selectedHours);
                    var duplicateHoursRemoved = this.scheduleData[day].filter(function(hours, index, self) {
                        return index == self.indexOf(hours);
                    });
                    this.scheduleData[day] = duplicateHoursRemoved.sort();
                }.bind(this));
            },

            generateRenderedSchedule: function() {
                var schedule = [];
                for (var day in this.scheduleData) {
                    if (this.scheduleData[day].length > 0) {
                        var object = {};
                        object.day = day;
                        object.hours = this.scheduleData[day];
                        schedule.push(object);
                    }
                }
                this.renderedSchedule = schedule;
                this.polymerWorkaround();
            },

            polymerWorkaround: function() {
                var temp = this.renderedSchedule;
                this.renderedSchedule = [];
                this.renderedSchedule = temp;
            },

            resetDays: function() {
                this.selectedDays = [];
                this.marked = true;
                this.marked = false;
            }
        });
    </script>
</dom-module>
