<link rel="import" href="/vendor/polymer/polymer.html">

<dom-module id="cuac-item-form">
    <template>
        <style>
            label{
              font-weight: normal;
            }
            .show {
                display: block;
            }

            .hide {
                display: none;
            }
        </style>
        <cuac-room-alert id="alert"></cuac-room-alert>
        <form class$="form {{formVisibility}}">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    {{exhibition.name}} &gt; <strong>New content</strong>
                </div>
                <div class="panel-body form-group">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="room">Room</label>
                            <input type="checkbox" class="room" name="room" on-change="hideUselessInputs"></input>
                        </div>
                        <div class="form-group number">
                            <label for="number">Number</label>
                            <input class="form-control" name="number" value="{{number::input}}" on-keyup="numberValidation"></input>
                        </div>
                        <div class="form-group">
                            <label for="beacon">Beacon Number</label>
                            <input class="form-control" name="beacon" value="{{beacon::input}}"></input>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="name"><strong>Name*</strong></label>
                            <input class="form-control" name="name" value="{{name::input}}" on-keyup="saveActivation" autofocus></input>
                        </div>
                        <div class="form-group">
                            <label for="author">Author</label>
                            <input class="form-control" name="author" value="{{author::input}}" disabled="{{disableItemInput}}" type="text"></input>
                        </div>
                        <div class="form-group">
                            <label for="date">Date</label>
                            <input class="form-control" maxlength="4" name="date" value="{{date::input}}" disabled="{{disableItemInput}}" type="text"></input>
                        </div>
                        <div class="form-group">
                            <label for="description">Description</label>
                            <textarea class="form-control" name="description" value="{{description::input}}"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center">
                <button type="button" class="btn btn-primary submit" on-click="submitClicked" disabled="{{disableSaveButton}}">Save</button>
            </div>
        </form>

    </template>

    <script>
        Polymer({
            is: 'cuac-item-form',

            properties: {

                formVisibility: { type: String },

                disableItemInput: { type: Boolean, value: false },

                disableSaveButton: { type: Boolean, value: true},

                name: { type: String, value: '' },

                author: { type: String, value: '' },

                date: { type: String, value: ''},

                number: {type: Number },

                beacon: { type: String },

                description: { type: String },

                exhibition: { type: Object },

            },

            hideUselessInputs: function(event) {
                if (event.target.checked) {
                    if(this.essentialItemFieldsHasContent()){
                        this.fire('roomAlert');
                    }
                    this.disableItemInput = true;
                } else {
                    this.disableItemInput = false;
                }
            },

            essentialItemFieldsHasContent: function() {
                return (this.date.length > 0 || this.author.length > 0)
            },

            submitClicked: function(event) {
                event.preventDefault();
                this.formVisibility = 'hide';
                this.fire('submitted', this.collectData());
            },

            collectData: function() {
                data = {
                    name: this.name,
                    author: this.author,
                    date: this.date,
                    number: this.number,
                    beacon: this.beacon,
                    description: this.description,
                    exhibition_id: this.exhibition.id
                };
                return data;
            },

            numberValidation: function() {
                this.saveActivation();
                this.numberTextboxColor();
            },

            saveActivation: function() {
                if ( (this.exhibition.numbers.indexOf(this.number) < 0) && (this.name.length > 0) ) {
                    this.disableSaveButton = false;
                } else {
                    this.disableSaveButton = true;
                }
            },

            numberTextboxColor: function(){
                if((this.exhibition.numbers.indexOf(this.number) >= 0)){
                    this.showError();
                }else{
                    this.quitError();
                }
            },

            showError: function() {
                this.$$(".number").classList.add('has-error');
            },

            quitError: function() {
                this.$$(".number").classList.remove('has-error');
            }

        });
    </script>
</dom-module>
