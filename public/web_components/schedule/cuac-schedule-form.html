<link rel="import" href="/vendor/polymer/polymer.html">

<dom-module id="cuac-schedule-form">
    <template>
        <form class="col-md-12">
            <cuac-schedule-days id="days" cleardays="{{resetDays}}"></cuac-schedule-days>
            <cuac-schedule-hours id="hours" clearhours="{{resetHours}}"></cuac-schedule-hours>
            <div class="col-md-12">
                <button class="submit btn btn-primary" on-click="submitClicked" disabled$="{{disableSave}}">Save</button>
            </div>
        </form>
        <div class="col-md-12">
            <cuac-schedule-view id="result" hidden="{{viewHidden}}"></cuac-schedule-view>
        </div>
    </template>

    <script>
        Polymer({
            is: 'cuac-schedule-form',

            ready: function() {
                this.addEventListener('daySelected', this.setDays.bind(this));
                this.addEventListener('addClicked', this.storeSchedule.bind(this));
                this.storage = {MON: [], TUE: [], WED: [], THU: [], FRI: [], SAT: [], SUN: []};
            },

            properties: {

                disableSave: {type: String, value: 'disabled'},

                hidden: {type: Boolean, reflectToAttribute: true},

                viewHidden: {type: Boolean, value: true, reflectToAttribute: true},

                days: {type: Array},

                schedule: {type: Array, reflectToAttribute: true},

                resetSchedule: {type: Boolean, value: false, reflectToAttribute: true}
            },

            submitClicked: function(event) {
                event.preventDefault();
                this.hide();
            },

            hide: function() {
                this.formVisibility = 'hide';
            },

            toggleSave: function(event) {
                if (event.detail) {
                    this.disableSave = null;
                } else {
                    this.disableSave = 'disabled';
                }
            },

            setDays: function(days) {
              this.days = days.detail;
            },

            storeSchedule: function(event) {
                var actualSchedule = event.detail;
                var selectedDay = actualSchedule.days;
                var hoursFilled = actualSchedule.hours;
                this.schedule = [];
                var storage = this.storage;
                var schedule = this.schedule;
      
                selectedDay.forEach(function(day) {
                    storage[day].push(hoursFilled);
                });

                for (var day in storage) {
                    if (storage[day].length != 0) {
                        var object = {};
                        object.day = day;
                        object.hours = storage[day];
                        schedule.push(object);            
                    }
                };
 
                this.storage = storage;
                this.schedule = schedule;
                this.fire('scheduleGenerated', this.schedule);

                this.viewHidden = false;
                this.resetScheduleFilled();
            },

            resetScheduleFilled: function() {
                this.resetDays = true;
                this.resetHours = true;
            },

        });
    </script>
</dom-module>

if storage[day] != hoursFilled