<link rel="import" href="/vendor/polymer/polymer.html">

<dom-module id="cuac-schedule-hours">
    <template>
        <div class="form-group">
            <input class="form-control"  name="openingHours" value={{openingHours::input}}></input>
            <button class="add-button" on-click="addClicked" disabled$="{{disabledAdd}}">+</button>
        </div>
    </template>

    <script>
        Polymer({
            is: 'cuac-schedule-hours',

            properties: {

                openingHours: {type: String, observer: 'hoursChanged'},

                disabledAdd: {type: Boolean, value: true, reflectToAttribute: true},

                days: {type: Array, reflectToAttribute: true, observer: 'daysChanged'},

                clear: {type: Boolean, value: false, reflectToAttribute: true, 
                    observer: 'clearHours'}

            },


            hasDays: function() {
                this.days = this.days || [];
                return (this.days.length > 0);
            },

            isProperInput: function() {
                return this.isValid(this.openingHours);
            },

            updateButtonStatus: function() {
                if (this.hasDays() && this.isProperInput()) {
                    this.activateAdd();
                } else {
                    this.deactivateAdd();
                }
            },

            hoursChanged: function() {
                this.updateButtonStatus();
            },

            daysChanged: function() {
                this.updateButtonStatus();

            },

            activateAdd: function() {
                this.disabledAdd = false;
            },

            deactivateAdd: function() {
                this.disabledAdd = true;
            },

            isValidTimeLength: function() {
                var acceptedLength = 11;
                return (this.openingHours.length === acceptedLength);
            },

            isValidTimeFormat: function() {
                var timeRegexp = /^([01]?[0-9]|2[0-3]):[0-5][0-9]/;
                this.openingTime = this.openingHours.split('/')[0];
                this.closingTime = this.openingHours.split('/')[1];
                return (timeRegexp.test(this.openingTime) && timeRegexp.test(this.closingTime));
            },

            isValidHourRange: function() {
                var openingTime = Number(this.openingTime.replace(':', ''));
                var closingTime = Number(this.closingTime.replace(':', ''));
                return (openingTime < closingTime);
            },

            isValid: function() {
                var validLength = this.isValidTimeLength();
                var validFormat = this.isValidTimeFormat();
                var validRange = this.isValidHourRange();

                return (validLength &&Â validFormat && validRange);
            },

            addClicked: function(event) {
                event.preventDefault();
                var actualSchedule = {days: this.days, hours: this.openingHours};
                this.fire('addClicked', actualSchedule);

            },

            clearHours: function(){
                if  (this.clear) {
                    this.openingHours = '';
                    this.clear = false;
                }

            }

        });
    </script>
</dom-module>
