<link rel="import" href="/vendor/polymer/polymer.html">

<dom-module id="cuac-contact-form">
    <template>
        <style>
            .form.show {
                display: block;
            }
            .form.hide {
                display: none;
            }
        </style>

        <form class$="{{formVisibility}}">
            <template is="dom-repeat" items="{{contactDetail}}">
                <div class="form-group">
                    <div class="col-md-4">
                        <label>{{item.label}}</label>
                    </div>
                    <div class="col-md-8">
                        <cuac-input-container inputtype="{{item.type}}"></cuac-input-container>
                    </div>
                </div>
            </template>
            <div>
                <button class="submit btn btn-primary" on-click="submitClicked" disabled$="{{disableSave}}">Save</button>
            </div>
        </form>
        <cuac-contact-view hidden="{{viewHidden}}" storage="{{renderedStorage}}"></cuac-contact-view>
    </template>

    <script>
        Polymer({
            is: 'cuac-contact-form',

            ready: function() {
                this.addEventListener('saveToggled', this.toggleSave.bind(this));
                this.addEventListener('blured', this.updateStorage.bind(this));
            },

            properties: {

                formVisibility: {type: String, value: 'show'},

                contactDetail: {type: Array},

                storage: {type: Object, reflectToAttribute: true},

                renderedStorage: {type: Object, reflectToAttribute: true},

                disableSave: {type: String, value: 'disabled'},

                viewHidden: {type: Boolean, value: true}
            },

            submitClicked: function(event) {
                event.preventDefault();
                this.renderedStorage = this.storage;
                this.hide();
                this.viewHidden = false;
            },

            hide: function() {
                this.formVisibility = 'hide';
            },

            toggleSave: function(event) {
                if (event.detail) {
                    this.disableSave = null;
                } else {
                    this.disableSave = 'disabled';
                }
            },

            updateStorage: function(event) {
                var input = event.detail;

                if (this.newEntry(input)) {
                    this.storage[input.type].push(input.content);
                } else {
                    this.updateEntry(input);
                }
            },

            newEntry: function(input) {
                var storedValue = this.storage[input.type][input.index];
                return storedValue === undefined;
            },

            updateEntry: function(input) {
                this.storage[input.type][input.index] = input.content;
            }
        });
    </script>
</dom-module>
